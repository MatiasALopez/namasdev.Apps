@using namasdev.Apps.Web.Portal.Helpers;
@model namasdev.Apps.Entidades.Entidad
@{
    var namespaces = new
    {
        Aplicacion = Model.AplicacionVersion.Aplicacion.Nombre,
        Datos = string.Format("{0}.Data", Model.AplicacionVersion.Aplicacion.Nombre),
    };
    var clases = new
    {
        Entidad = Model.Nombre,
        Repositorio = string.Format("{0}Repository", Model.NombrePlural)
    };
    var interfaces = new
    {
        Repositorio = string.Format("I{0}", clases.Repositorio)
    };
    var variablesNombres = new
    {
        Entidad = "entity",
        Propiedades = "properties",
    };
    var textos = new 
    {
        TODOChecks = "// TODO (Gen): check FKs, unique indexes, check constraints",
    };
    string claveTipo = Model.Especificaciones.IDTipo != null ? Model.Especificaciones.IDTipo.CLRType : null,
        tiposGenericosEntidadYId = string.Format("{0}, {1}", Model.Nombre, claveTipo);

    bool usarRepositorioBase = !string.IsNullOrWhiteSpace(claveTipo);
}
using System;
using System.Collections.Generic;
using System.Linq;

using namasdev.Data;
using namasdev.Data.Entity;

using @(Html.Raw(namespaces.Aplicacion)).Entities;
using @(Html.Raw(namespaces.Datos)).Sql;

// TODO (Gen): add DbSet to SqlContext
namespace @Html.Raw(namespaces.Datos)
{
    public interface @Html.Raw(interfaces.Repositorio) @Html.Raw(usarRepositorioBase ? string.Format(": {0}", FormatoHelper.Generic("IRepository", tiposGenericosEntidadYId)) : "")
    {
    }

    public class @Html.Raw(clases.Repositorio) : @Html.Raw(usarRepositorioBase ? FormatoHelper.Generic("Repository", "SqlContext", tiposGenericosEntidadYId) : ""), @Html.Raw(interfaces.Repositorio)
    {
        @if (Model.Indices.Any(i => i.EsUnique)
        || Model.AsociacionesOrigen.Any())
        {
        <text>public override void Add(@clases.Entidad @variablesNombres.Entidad)
        {
            try
            {
                base.Add(@variablesNombres.Entidad);
            }
            catch (Exception)
            {
                @textos.TODOChecks
                throw;
            }
        }

        public override void Update(@clases.Entidad @variablesNombres.Entidad)
        {
            try
            {
                base.Update(@variablesNombres.Entidad);
            }
            catch (Exception)
            {
                @textos.TODOChecks
                throw;
            }
        }

        public override void UpdateProperties(@clases.Entidad @variablesNombres.Entidad, params string[] @variablesNombres.Propiedades)
        {
            try
            {
                base.ActualizarPropiedades(@variablesNombres.Entidad, @variablesNombres.Propiedades);
            }
            catch (Exception)
            {
                @textos.TODOChecks
                throw;
            }
        }
</text>}
    }
}
