@using namasdev.Apps.Web.Portal.Helpers;
@model namasdev.Apps.Entidades.Entidad
@{
    var idiomaTextos = Model.AplicacionVersion.Aplicacion.Idioma.Textos.Idioma.Textos;
    bool esSoloLectura = Model.Especificaciones.EsSoloLectura;
    var namespaces = new
    {
        Aplicacion = Model.AplicacionVersion.Aplicacion.Nombre,
        Datos = idiomaTextos.DatosNombre,
        Entidades = idiomaTextos.EntidadesNombre,
    };
    var clases = new
    {
        Entidad = Model.Nombre,
        Repositorio = string.Format("{0}{1}", idiomaTextos.Repositorio, esSoloLectura ? "ReadOnly" : ""),
        RepositorioEntidad = string.Format("{0}{1}", Model.NombrePlural, idiomaTextos.Repositorio)
    };
    var interfaces = new
    {
        Repositorio = string.Format("I{0}", clases.Repositorio),
        RepositorioEntidad = string.Format("I{0}", clases.RepositorioEntidad),
    };
    var variables = new
    {
        Entidad = "entity",
        Propiedades = "properties",
    };
    var metodos = new
    {
        Agregar = idiomaTextos.Agregar,
        Actualizar = idiomaTextos.Actualizar,
        ActualizarPropiedades = string.Format("{0}{1}", idiomaTextos.Actualizar, idiomaTextos.Propiedades),
    };
    var textos = new
    {
        TODOChecks = "// TODO (Gen): check FKs, unique indexes, check constraints",
    };
    string claveTipo = Model.Especificaciones.IDTipo != null ? Model.Especificaciones.IDTipo.CLRType : null,
        tiposGenericosEntidadYId = string.Format("{0}, {1}", Model.Nombre, claveTipo);
    bool usarRepositorioBase = !string.IsNullOrWhiteSpace(claveTipo);
}
using System;
using System.Collections.Generic;
using System.Linq;

using namasdev.Data;
using namasdev.Data.Entity;

using @(Html.Raw(namespaces.Aplicacion)).@(Html.Raw(namespaces.Entidades));
using @(Html.Raw(namespaces.Aplicacion)).@(Html.Raw(namespaces.Datos)).Sql;

// TODO (Gen): add DbSet to SqlContext
namespace @Html.Raw(namespaces.Aplicacion).@(namespaces.Datos)
{
    public interface @Html.Raw(interfaces.RepositorioEntidad) @Html.Raw(usarRepositorioBase ? string.Format(": {0}", FormatoHelper.Generic(interfaces.Repositorio, tiposGenericosEntidadYId)) : "")
    {
    }

    public class @Html.Raw(clases.RepositorioEntidad) : @Html.Raw(usarRepositorioBase ? FormatoHelper.Generic(clases.Repositorio, "SqlContext", tiposGenericosEntidadYId) : ""), @Html.Raw(interfaces.RepositorioEntidad)
    {
        @if (!esSoloLectura
            && (Model.Indices.Any(i => i.EsUnique)
                || Model.AsociacionesOrigen.Any()))
        {
        <text>public override void @(metodos.Agregar)(@clases.Entidad @variables.Entidad)
        {
            try
            {
                base.@(metodos.Agregar)(@variables.Entidad);
            }
            catch (Exception)
            {
                @textos.TODOChecks
                throw;
            }
        }

        public override void @(metodos.Actualizar)(@clases.Entidad @variables.Entidad)
        {
            try
            {
                base.@(metodos.Actualizar)(@variables.Entidad);
            }
            catch (Exception)
            {
                @textos.TODOChecks
                throw;
            }
        }

        public override void @(metodos.ActualizarPropiedades)(@clases.Entidad @variables.Entidad, params string[] @variables.Propiedades)
        {
            try
            {
                base.@(metodos.ActualizarPropiedades)(@variables.Entidad, @variables.Propiedades);
            }
            catch (Exception)
            {
                @textos.TODOChecks
                throw;
            }
        }
</text>}
    }
}
