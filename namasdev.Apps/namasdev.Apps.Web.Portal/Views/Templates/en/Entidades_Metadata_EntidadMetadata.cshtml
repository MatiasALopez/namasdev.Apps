@using namasdev.Apps.Entidades.Valores;
@using namasdev.Apps.Web.Portal.Helpers;
@model namasdev.Apps.Entidades.Entidad
@{
    var idiomaTextos = Model.AplicacionVersion.Aplicacion.Idioma.Textos.Idioma.Textos;
    var namespaces = new
    {
        Aplicacion = Model.AplicacionVersion.Aplicacion.Nombre,
        Entidades = idiomaTextos.EntidadesNombre,
    };
    var clases = new
    {
        Metadata = string.Format("{0}Metadata", Model.Nombre)
    };
    var variables = new
    {
        Repositorio = "repository",
        UsuarioId = "userId",
    };
    var constantes = new
    {
        Etiqueta = EntidadMetadataAtributos_en.ETIQUETA,
    };
    var constantesDefiniciones = new
    {
        Etiqueta = FormatoHelper.TipoYNombre("string", EntidadMetadataAtributos_en.ETIQUETA),
        TamañoExacto = FormatoHelper.TipoYNombre("int", EntidadMetadataAtributos_en.TAMAÑO_EXACTO),
        TamañoMax = FormatoHelper.TipoYNombre("int", EntidadMetadataAtributos_en.TAMAÑO_MAX),
        TamañoMin = FormatoHelper.TipoYNombre("int", EntidadMetadataAtributos_en.TAMAÑO_MIN),
        RegEx = FormatoHelper.TipoYNombre("string", EntidadMetadataAtributos_en.REG_EX),
        ValorMinimoEntero = FormatoHelper.TipoYNombre("int", EntidadMetadataAtributos_en.VALOR_MINIMO),
        ValorMaximoEntero = FormatoHelper.TipoYNombre("int", EntidadMetadataAtributos_en.VALOR_MAXIMO),
        ValorMinimoEnteroCorto = FormatoHelper.TipoYNombre("short", EntidadMetadataAtributos_en.VALOR_MINIMO),
        ValorMaximoEnteroCorto = FormatoHelper.TipoYNombre("short", EntidadMetadataAtributos_en.VALOR_MAXIMO),
        ValorMinimoEnteroLargo = FormatoHelper.TipoYNombre("long", EntidadMetadataAtributos_en.VALOR_MINIMO),
        ValorMaximoEnteroLargo = FormatoHelper.TipoYNombre("long", EntidadMetadataAtributos_en.VALOR_MAXIMO),
        ValorMinimoDecimal = FormatoHelper.TipoYNombre("decimal", EntidadMetadataAtributos_en.VALOR_MINIMO),
        ValorMaximoDecimal = FormatoHelper.TipoYNombre("decimal", EntidadMetadataAtributos_en.VALOR_MAXIMO),
        ValorMinimoDecimalFlotante = FormatoHelper.TipoYNombre("double", EntidadMetadataAtributos_en.VALOR_MINIMO),
        ValorMaximoDecimalFlotante = FormatoHelper.TipoYNombre("double", EntidadMetadataAtributos_en.VALOR_MAXIMO),
        DigitosEnteros = FormatoHelper.TipoYNombre("int", EntidadMetadataAtributos_en.DIGITOS_ENTEROS),
        DigitosDecimales = FormatoHelper.TipoYNombre("int", EntidadMetadataAtributos_en.DIGITOS_DECIMALES),
    };
    Dictionary<string, string> propiedadConstantes;
}
namespace @(Html.Raw(namespaces.Aplicacion)).@(Html.Raw(namespaces.Entidades)).Metadata
{
    public class @Html.Raw(clases.Metadata)
    {
        public const string NAME = "@Html.Raw(Model.Nombre)";
        public const string NAME_PLURAL = "@Html.Raw(Model.NombrePlural)";

        public const string LABEL = "@Html.Raw(Model.Etiqueta)";
        public const string LABEL_PLURAL = "@Html.Raw(Model.EtiquetaPlural)";

        public class DB
        {
            public const string TABLE = "@Html.Raw(Model.NombrePlural)";
        @if (Model.Especificaciones.IDPropiedadTipoId.HasValue)
        {
            <text>public const string ID = "@(Html.Raw(Model.Propiedades.First(p => p.EsID).Nombre))";</text>
        }
        }

        public class @idiomaTextos.Propiedades
        {
        @foreach(var p in Model.Propiedades)
        {
            propiedadConstantes = new Dictionary<string, string>
            {
                { constantesDefiniciones.Etiqueta, FormatoHelper.EntreComillas(p.Etiqueta) }
            };
            switch (p.PropiedadTipoId)
            {
                case PropiedadTipos.TEXTO:
                    if (p.EspecificacionesTexto.TamañoExacto.HasValue)
                    {
                        propiedadConstantes.Add(constantesDefiniciones.TamañoExacto, p.EspecificacionesTexto.TamañoExacto.ToString());
                    }
                    else
                    {
                        if (p.EspecificacionesTexto.TamañoMinimo.HasValue)
                        {
                            propiedadConstantes.Add(constantesDefiniciones.TamañoMin, p.EspecificacionesTexto.TamañoMinimo.ToString());
                        }
                        if (p.EspecificacionesTexto.TamañoMaximo.HasValue)
                        {
                            propiedadConstantes.Add(constantesDefiniciones.TamañoMax, p.EspecificacionesTexto.TamañoMaximo.ToString());
                        }
                    }
                    if (!string.IsNullOrWhiteSpace(p.EspecificacionesTexto.RegEx))
                    {
                        propiedadConstantes.Add(constantesDefiniciones.RegEx, "@" + FormatoHelper.EntreComillas(p.EspecificacionesTexto.RegEx));
                    }
                    break;
                case PropiedadTipos.ENTERO:
                    propiedadConstantes.Add(constantesDefiniciones.ValorMinimoEntero, (p.EspecificacionesEntero.ValorMinimo ?? int.MinValue).ToString());
                    propiedadConstantes.Add(constantesDefiniciones.ValorMaximoEntero, (p.EspecificacionesEntero.ValorMaximo ?? int.MaxValue).ToString());
                    break;
                case PropiedadTipos.ENTERO_CORTO:
                    propiedadConstantes.Add(constantesDefiniciones.ValorMinimoEnteroCorto, (p.EspecificacionesEnteroCorto.ValorMinimo ?? short.MinValue).ToString());
                    propiedadConstantes.Add(constantesDefiniciones.ValorMaximoEnteroCorto, (p.EspecificacionesEnteroCorto.ValorMaximo ?? short.MaxValue).ToString());
                    break;
                case PropiedadTipos.ENTERO_LARGO:
                    if (p.EspecificacionesEnteroLargo.ValorMinimo.HasValue)
                    {
                        propiedadConstantes.Add(constantesDefiniciones.ValorMinimoEnteroLargo, p.EspecificacionesEnteroLargo.ValorMinimo.ToString());
                    }
                    if (p.EspecificacionesEnteroLargo.ValorMaximo.HasValue)
                    {
                        propiedadConstantes.Add(constantesDefiniciones.ValorMaximoEnteroLargo, p.EspecificacionesEnteroLargo.ValorMaximo.ToString());
                    }
                    break;
                case PropiedadTipos.DECIMAL:
                    propiedadConstantes.Add(constantesDefiniciones.DigitosEnteros, p.EspecificacionesDecimal.DigitosEnteros.ToString());
                    propiedadConstantes.Add(constantesDefiniciones.DigitosDecimales, p.EspecificacionesDecimal.DigitosDecimales.ToString());
                    propiedadConstantes.Add(constantesDefiniciones.ValorMinimoDecimal, FormatoHelper.ValorConSufijo(p.EspecificacionesDecimal.ValorMinimo ?? p.EspecificacionesDecimal.ValorMinimoDesdeDigitos));
                    propiedadConstantes.Add(constantesDefiniciones.ValorMaximoDecimal, FormatoHelper.ValorConSufijo(p.EspecificacionesDecimal.ValorMaximo ?? p.EspecificacionesDecimal.ValorMaximoDesdeDigitos));
                    break;
                case PropiedadTipos.DECIMAL_FLOTANTE:
                    propiedadConstantes.Add(constantesDefiniciones.DigitosEnteros, p.EspecificacionesDecimalFlotante.DigitosEnteros.ToString());
                    propiedadConstantes.Add(constantesDefiniciones.DigitosDecimales, p.EspecificacionesDecimalFlotante.DigitosDecimales.ToString());
                    propiedadConstantes.Add(constantesDefiniciones.ValorMinimoDecimal, (p.EspecificacionesDecimalFlotante.ValorMinimo ?? p.EspecificacionesDecimalFlotante.ValorMinimoDesdeDigitos).ToString());
                    propiedadConstantes.Add(constantesDefiniciones.ValorMaximoDecimal, (p.EspecificacionesDecimalFlotante.ValorMaximo ?? p.EspecificacionesDecimalFlotante.ValorMaximoDesdeDigitos).ToString());
                    break;
                case PropiedadTipos.IMPORTE:
                    propiedadConstantes.Add(constantesDefiniciones.DigitosDecimales, "4");
                    if (p.EspecificacionesImporte.ValorMinimo.HasValue)
                    {
                        propiedadConstantes.Add(constantesDefiniciones.ValorMinimoDecimal, p.EspecificacionesImporte.ValorMinimo.ToString());
                    }
                    if (p.EspecificacionesImporte.ValorMaximo.HasValue)
                    {
                        propiedadConstantes.Add(constantesDefiniciones.ValorMaximoDecimal, p.EspecificacionesImporte.ValorMaximo.ToString());
                    }
                    break;
            }
            <text>public class @Html.Raw(p.NombreOId)
            {
                @foreach (var c in propiedadConstantes)
                {
                <text>public const @Html.Raw(c.Key) = @Html.Raw(c.Value);</text>
                }
            }</text>
        }
        }
        @if (!Model.Especificaciones.EsSoloLectura)
        {
        <text>
        public class Messages
        {
            public const string ADD_OK = @(Html.Raw(clases.Metadata)).@(constantes.Etiqueta) + " added successfully.";
            public const string ADD_ERROR = @(Html.Raw(clases.Metadata)).@(constantes.Etiqueta) + " add failed.";

            public const string UPDATE_OK = @(Html.Raw(clases.Metadata)).@(constantes.Etiqueta) + " updated successfully.";
            public const string UPDATE_ERROR = @(Html.Raw(clases.Metadata)).@(constantes.Etiqueta) + " update failed.";
        @if (Model.Especificaciones.BajaTipoId != BajaTipos.NINGUNA)
        {
            <text>
            public const string DELETE_OK = @(Html.Raw(clases.Metadata)).@(constantes.Etiqueta) + " deleted successfully.";
            public const string DELETE_ERROR = @(Html.Raw(clases.Metadata)).@(constantes.Etiqueta) + " delete failed.";
            public const string DELETE_CONFIRMATION = "Are you sure you want to delete the selected " + @(Html.Raw(clases.Metadata)).@(constantes.Etiqueta) + "?";
            </text>
        }
        }
        </text>
        }
    }
}
