@using namasdev.Apps.Entidades;
@using namasdev.Apps.Entidades.Valores; 
@using namasdev.Apps.Web.Portal.Helpers;
@model Entidad
@{
    var namespaces = new
    {
        Aplicacion = Model.AplicacionVersion.Aplicacion.Nombre
    };
    var clases = new
    {
        EntidadViewModel = string.Format("{0}ViewModel", Model.Nombre),
        Metadata = string.Format("{0}Metadata", Model.Nombre),
        MetadataPropiedades = string.Format("{0}Metadata.Propiedades", Model.Nombre),
        PaginaModo = "PageMode",
    };
    var propiedades = new 
    {
        PaginaModo = "PageMode",
    };
    EntidadPropiedad propiedadId = null;
    bool tienePropiedadesBoolean = false,
        tienePropiedadesHora = false;
}
using System;
using System.Collections.Generic;
using System.ComponentModel.DataAnnotations;
using System.Web.Mvc;

using namasdev.Core.Validation;
using namasdev.Web.Models;

using @(Html.Raw(namespaces.Aplicacion)).Entities.Metadata;

namespace @(Html.Raw(namespaces.Aplicacion)).Web.Portal.ViewModels.@Html.Raw(Model.NombrePlural)
{
    public class @Html.Raw(clases.EntidadViewModel) : IValidatableObject
    {
        public @clases.PaginaModo @propiedades.PaginaModo { get; set; }

    @foreach(var p in Model.Propiedades)
    {
        if (p.EsCalculada || p.EsAuditoria) { continue; }
        if (p.EsID) { propiedadId = p; }
        if (p.PropiedadTipoId == PropiedadTipos.BOOLEANO) { tienePropiedadesBoolean = true; }
        else if (p.PropiedadTipoId == PropiedadTipos.FECHA_HORA || p.PropiedadTipoId == PropiedadTipos.HORA) { tienePropiedadesHora = true; }
        <text>[Display(Name = @(Html.Raw(clases.MetadataPropiedades)).@(Html.Raw(p.NombreOId)).LABEL)]
        @if (!p.PermiteNull && !p.EsID)
        {
        <text>[Required(ErrorMessage = Validator.Messages.Formats.REQUIRED)]</text>
        }
        public @p.Tipo.CLRTypeNullable @Html.Raw(p.NombreOId) { get; set; }
        </text>
    }
    @if (tienePropiedadesBoolean) 
    { 
    <text>public SelectList YesNoSelectList { get; set; }</text>
    }
    @if (tienePropiedadesHora) 
    { 
    <text>public SelectList TimeSelectList { get; set; }</text>
    }

        public @Html.Raw(FormatoHelper.Generic("IEnumerable", "ValidationResult")) Validate(ValidationContext validationContext)
        {
        @if (propiedadId != null)
        {
            <text>if (@propiedades.PaginaModo == @(clases.PaginaModo).Edit
                && @FormatoHelper.ExpresionCheckNoNull(propiedadId.NombreOId, propiedadId.Tipo))
            {
                yield return new ValidationResult(Validator.Messages.Required(@(Html.Raw(clases.Metadata)).LABEL));
            }</text>
        }
        }
    }
}
